<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>quiz_1_554_cs</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="quiz_1_554_cs_files/libs/clipboard/clipboard.min.js"></script>
<script src="quiz_1_554_cs_files/libs/quarto-html/quarto.js"></script>
<script src="quiz_1_554_cs_files/libs/quarto-html/popper.min.js"></script>
<script src="quiz_1_554_cs_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="quiz_1_554_cs_files/libs/quarto-html/anchor.min.js"></script>
<link href="quiz_1_554_cs_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="quiz_1_554_cs_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="quiz_1_554_cs_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="quiz_1_554_cs_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="quiz_1_554_cs_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">



<section id="quiz-1-cs" class="level1">
<h1>554 Quiz 1 CS</h1>
<section id="observational-vs-experimental-studies" class="level2">
<h2 class="anchored" data-anchor-id="observational-vs-experimental-studies">Observational vs Experimental Studies</h2>
<ul>
<li><strong>Experimental</strong>: The researcher <strong>manipulates</strong> the independent variable and observes the effect on the dependent variable.
<ul>
<li>E.g See if new gym class reduces body fat percentage, so <strong>randomly assign</strong> people to new and old class</li>
</ul></li>
<li><strong>Observational</strong>: The researcher observes the effect of the independent variable on the dependent variable without manipulating the independent variable.
<ul>
<li>E.g. See if new gym class reduces body fat percentage, so <strong>select</strong> people who signed up for new and old class</li>
</ul></li>
</ul>
</section>
<section id="hypothesis-testing-review" class="level2">
<h2 class="anchored" data-anchor-id="hypothesis-testing-review">Hypothesis Testing Review</h2>
<ul>
<li><p>Recall <a href="https://mds.farrandi.com/block_2/552_stat_inter/552_stat_inter#hypothesis-testing">552 Hypothesis Testing</a></p></li>
<li><p>Tolerance to <strong>Type I Error</strong> is <span class="math inline">\(\alpha\)</span></p>
<ul>
<li><span class="math inline">\(\alpha = P(\text{reject null} | \text{null is true})\)</span></li>
<li>Reject <span class="math inline">\(H_0\)</span> when <span class="math inline">\(p &lt; \alpha\)</span></li>
</ul></li>
</ul>
<section id="why-is-it-important-in-science" class="level3">
<h3 class="anchored" data-anchor-id="why-is-it-important-in-science">Why is it Important in Science?</h3>
<ul>
<li>Easier to publish paper if findings are significant at <span class="math inline">\(\alpha = 0.05\)</span></li>
<li>By Construction:
<ul>
<li><span class="math inline">\(H_0\)</span> is “conservative”/ “boring”/ “status quo”</li>
<li><span class="math inline">\(H_a\)</span> is “exciting”/ “new”/ “interesting”</li>
</ul></li>
<li>When <span class="math inline">\(p &gt; \alpha\)</span>, we fail to reject <span class="math inline">\(H_0\)</span>
<ul>
<li>Does not mean <span class="math inline">\(H_0\)</span> is true</li>
<li>Just means we do not have enough evidence to reject it</li>
<li>Makes bad headlines: (e.g.&nbsp;“Null Hypothesis Not Rejected”)</li>
</ul></li>
<li><strong>P-Hacking</strong>: Repeatedly testing until <span class="math inline">\(p &lt; \alpha\)</span>
<ul>
<li>Inflate Type I Error Rate</li>
<li>Does not always mean if <span class="math inline">\(p &lt; \alpha\)</span>, the result is significant
<ul>
<li>BE SCEPTICAL OF PAPERS, DO NOT BELIEVE EVERYTHING</li>
</ul></li>
<li>Need <strong>Bonferroni Correction</strong> to adjust for multiple comparisons</li>
</ul></li>
</ul>
</section>
<section id="example-finding-out-food-to-health-relationship" class="level3">
<h3 class="anchored" data-anchor-id="example-finding-out-food-to-health-relationship">Example: Finding out Food to Health Relationship</h3>
<ul>
<li>Have 20 foods to test and 20 body parts to test</li>
<li>In total get 400 tests (20 foods * 20 body parts)</li>
<li>Simulate that the food is NOT related to any body part</li>
<li>However, when we randomly test, we will get around 40% of the tests significant at <span class="math inline">\(\alpha = 0.05\)</span>
<ul>
<li>162 tests is significant of the 400</li>
</ul></li>
<li>This is because of <strong>Multiple Comparisons</strong>
<ul>
<li>We inflate the Type I Error Rate (<span class="math inline">\(\alpha\)</span> is too high)</li>
<li>Need to adjust (decrease) <span class="math inline">\(\alpha\)</span> to account for multiple comparisons</li>
</ul></li>
</ul>
<section id="why-is-this-the-case" class="level4">
<h4 class="anchored" data-anchor-id="why-is-this-the-case">Why is this the case?</h4>
<p><span class="math display">\[
E_ i = \text{Committing Type I error in the } i \text{th test} \\
P(E_ i) = \alpha.
\]</span></p>
<p>The probability of NOT committing Type I error in the <span class="math inline">\(i\)</span>th test is the following: <span class="math display">\[P\left(E_ i^c\right) = 1 - \alpha\]</span></p>
<p>Probability of NOT committing Type I error in any of the tests is: <span class="math display">\[P\left(\bigcap_{i=1}^n E_ i^c\right) = \left(1 - \alpha\right)^n\]</span></p>
<p>Probability of committing at least one Type I error in the tests is: <span class="math display">\[P\left(\bigcup_{i=1}^n E_ i\right) = 1 - P\left(\bigcap_{i=1}^n E_ i^c\right) = 1 - \left(1 - \alpha\right)^n\]</span></p>
<p>The inflated probability corresponds to committing AT LEAST one Type I error in the <span class="math inline">\(m\)</span> tests.</p>
</section>
</section>
</section>
<section id="multiple-comparisons" class="level2">
<h2 class="anchored" data-anchor-id="multiple-comparisons">Multiple Comparisons</h2>
<section id="bonferroni-correction" class="level3">
<h3 class="anchored" data-anchor-id="bonferroni-correction">Bonferroni Correction</h3>
<ul>
<li>Conservatively guard against p-hacking</li>
<li>Idea: If we do <span class="math inline">\(m\)</span> tests, then <span class="math inline">\(\alpha\)</span> should be <span class="math inline">\(\frac{\alpha}{m}\)</span></li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pval <span class="co"># Matrix of p-values</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Bonferroni Correction</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>pval_corrected <span class="ot">=</span> <span class="fu">p.adjust</span>(pval, <span class="at">method =</span> <span class="st">"bonferroni"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="bonferroni-guarantee" class="level3">
<h3 class="anchored" data-anchor-id="bonferroni-guarantee">Bonferroni Guarantee</h3>
<p>Let <span class="math inline">\(R_i\)</span> be the event of rejecting <span class="math inline">\(H_0\)</span> when <span class="math inline">\(H_0\)</span> is true for the <span class="math inline">\(i\)</span>th test. Then:</p>
<p><span class="math display">\[
P\left(E_ i^c\right) \leq \sum_{i=1}^m P\left(R_i\right)
\]</span></p>
<p>This leads to the <strong>Family-Wise Error Rate (FWER)</strong></p>
<ul>
<li>The chance that <strong>one or more</strong> of the true null hypotheses is rejected</li>
</ul>
<p><span class="math display">\[
FWER \leq \sum_{i=1}^m \frac{\alpha}{m} = \alpha
\]</span></p>
<ul>
<li><p>The Bonferroni Correction guarantees that we <strong>wrongly reject</strong> the null hypothesis with probability less than <span class="math inline">\(\alpha\)</span></p></li>
<li><p><strong>Drawback: Very Conservative</strong></p></li>
</ul>
<p><span class="math display">\[P(R_1 \; \cup \; R_2) \leq P(R_1) + P(R_2)\]</span></p>
<p>Works if <span class="math inline">\(R_1\)</span> and <span class="math inline">\(R_2\)</span> are <em>mutually exclusive</em>.</p>
<ul>
<li>If not, then <span class="math inline">\(P(R_1 \; \cup \; R_2) = P(R_1) + P(R_2) - P(R_1 \; \cap \; R_2)\)</span></li>
</ul>
<p>So then the there will be too much correction -&gt; TOO CONSERVATIVE / More Type II Errors</p>
</section>
<section id="false-discovery-rate-fdr" class="level3">
<h3 class="anchored" data-anchor-id="false-discovery-rate-fdr">False Discovery Rate (FDR)</h3>
<ul>
<li>We cannot just look at p-value and see if study is significant</li>
<li>Need to find out how much “hunting” they did</li>
<li>There is a trade-off between <strong>false discoveries</strong> (FP) and <strong>missing real effects</strong> (FN)</li>
</ul>
<p><span class="math display">\[FDR = \frac{FP}{FP + TP}\]</span></p>
<ul>
<li><strong>LESS STRICT</strong> than Bonferroni Correction
<ul>
<li>It is a method to control the <strong>Expected Proportion of False Positives</strong> instead of the probability of <strong>one or more</strong> false positives</li>
</ul></li>
</ul>
<section id="benjamini-hochberg-bh-procedure" class="level4">
<h4 class="anchored" data-anchor-id="benjamini-hochberg-bh-procedure">Benjamini-Hochberg (BH) Procedure</h4>
<ul>
<li><p>One method to control FDR</p></li>
<li><p>Method:</p>
<ol type="1">
<li>Specify a <em>maximum acceptable FDR</em> <span class="math inline">\(\alpha\)</span></li>
<li>Order the p-values from smallest to largest</li>
<li>Find the largest <span class="math inline">\(k\)</span> such that <span class="math inline">\(p_{(k)} \leq \frac{k}{m} \alpha\)</span>
<ul>
<li><span class="math inline">\(p_{(k)}\)</span> is the <span class="math inline">\(k\)</span>th smallest p-value</li>
</ul></li>
<li>Take the <span class="math inline">\(k\)</span> smallest p-values as significant</li>
</ol></li>
<li><p>Get <strong>BH adjusted p-values</strong> as: <span class="math inline">\(\min \Big\{ \frac{p\text{-value}_i \times m}{i}, \text{BH adjusted } p\text{-value}_{i + 1} \Big\}\)</span></p></li>
</ul>
<div class="sourceCode" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Benjamini-Hochberg Procedure</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>pval_corrected <span class="ot">=</span> <span class="fu">p.adjust</span>(pval, <span class="at">method =</span> <span class="st">"fdr"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="when-to-use-fwer-vs.-fdr" class="level3">
<h3 class="anchored" data-anchor-id="when-to-use-fwer-vs.-fdr">When to Use FWER vs.&nbsp;FDR</h3>
<table class="table">
<colgroup>
<col style="width: 47%">
<col style="width: 52%">
</colgroup>
<thead>
<tr class="header">
<th>FWER</th>
<th>FDR</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>When there is high confidence to TP</td>
<td>When there is certain proportion of FP</td>
</tr>
<tr class="even">
<td>Want to be conservative</td>
<td>Want to be less conservative</td>
</tr>
<tr class="odd">
<td>Prefer <strong>False Negatives</strong></td>
<td>Prefer <strong>False Positives</strong></td>
</tr>
<tr class="even">
<td><code>TukeyHSD</code></td>
<td><code>pairwise.prop.test(method="BH")</code></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="simpsons-paradox" class="level2">
<h2 class="anchored" data-anchor-id="simpsons-paradox">Simpson’s Paradox</h2>
<ul>
<li>Arises when the association/trend between two variables is reversed when a third variable (<strong>confounder</strong>) is taken into account
<ul>
<li>Leads to deceptive statistical conclusions</li>
</ul></li>
</ul>
<p><img src="../images/2_sp_eg.png" width="500"></p>
<section id="confounding-factors" class="level3">
<h3 class="anchored" data-anchor-id="confounding-factors">Confounding Factors</h3>
<ul>
<li>Criteria to be a confounder:
<ol type="1">
<li>Related to the outcome by prognosis/ susceptibility</li>
<li>the distribution of the confounding factor is different in the groups being compared</li>
</ol></li>
<li>Confounder is a variable related to both the explanatory and response variables</li>
<li>Important to consider because without considering them, we may unkowingly observe a false demonstration of an association or the masking of an association between the explanatory and response variables.</li>
</ul>
<p><img src="../images/2_cofounder.png" width="200"></p>
</section>
<section id="strategies-to-address-confounding" class="level3">
<h3 class="anchored" data-anchor-id="strategies-to-address-confounding">Strategies to Address Confounding</h3>
<ol type="1">
<li><strong>Stratification</strong>: good for observational data
<ul>
<li>Implies checking the association between <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> within each stratum of the confounder</li>
<li><strong>Drawback</strong>: need to know all possible confounders</li>
</ul></li>
<li><strong>Analysis of Variance (ANOVA)</strong>: good for experimental data
<ul>
<li>Randomize each subject to a level of <span class="math inline">\(X\)</span>
<ul>
<li><strong>Randomization</strong> breaks the dependency between exploratory/ response variables and confounders</li>
</ul></li>
<li>Then compare <span class="math inline">\(Y\)</span> across levels of <span class="math inline">\(X\)</span> <br></li>
</ul></li>
</ol>
<ul>
<li>The <strong>second strategy</strong> is the golden standard in causal inference and design and analysis of experiments
<ul>
<li>The regressor <span class="math inline">\(X\)</span> is guaranteed to be independent of all possible confounders (known and unknown)</li>
<li>No longer need to be concerned with confounding</li>
<li>Can interpret the association between <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> in a causal manner</li>
</ul></li>
</ul>
</section>
</section>
<section id="foundations-of-ab-and-abn-testing" class="level2">
<h2 class="anchored" data-anchor-id="foundations-of-ab-and-abn-testing">Foundations of A/B and A/B/n Testing</h2>
<ul>
<li><strong>A/B Testing</strong>: randomized experiment between <strong>control</strong> and <strong>treatment</strong> groups</li>
<li><strong>A/B/n Testing</strong>: randomized experiment between <strong>control</strong> for more than 2 groups (n is not the same as n samples)</li>
<li>Recall: randomization makes variables independent of any confounding variables</li>
<li>Hence we can infer causality instead of just association</li>
</ul>
<section id="ab-testing-with-continuous-response" class="level3">
<h3 class="anchored" data-anchor-id="ab-testing-with-continuous-response">A/B Testing with Continuous Response</h3>
<section id="common-terminology" class="level4">
<h4 class="anchored" data-anchor-id="common-terminology">Common Terminology</h4>
<ul>
<li>Example: Have two categorical variables: <code>color</code>: blue/red and <code>font_size</code>: small/ medium/ large to predict <code>duration</code> of stay on a website</li>
<li><strong>Variables</strong>: <code>color</code>, <code>font_size</code>
<ul>
<li>6 possible treatment groups: 3 font sizes * 2 colors</li>
<li>If all 6 are used -&gt; <strong>Full Factorial Design</strong>, specifically <strong>2x3 Factorial Design</strong></li>
</ul></li>
<li>Each user is <strong>experimental unit</strong></li>
<li>Each treatment group involves <strong>replicates</strong> (multiple experimental units)
<ul>
<li>The experimental units are randomly assigned to treatment groups</li>
</ul></li>
</ul>
<table class="table">
<colgroup>
<col style="width: 7%">
<col style="width: 92%">
</colgroup>
<thead>
<tr class="header">
<th>Terms</th>
<th>Definitions</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Stratification</td>
<td>Process of splitting the population into homogenous subgroups and sampling observational units from the population independently in each subgroup.</td>
</tr>
<tr class="even">
<td>Factorial Design</td>
<td>Technique to investigate effects of several variables in one study; experimental units are assigned to all possible combinations of factors.</td>
</tr>
<tr class="odd">
<td>Cofounder</td>
<td>A variable that is associated with both the explanatory and response variable, which can result in either the false demonstration of an association, or the masking of an actual association between the explanatory and response variable.</td>
</tr>
<tr class="even">
<td>Blocking</td>
<td>Grouping experimental units (i.e., in a sample) together based on similarity.</td>
</tr>
<tr class="odd">
<td>Factor</td>
<td>Explanatory variable manipulated by the experimenter.</td>
</tr>
<tr class="even">
<td>Experimental Unit</td>
<td>The entity/object in the sample that is assigned to a treatment and for which information is collected.</td>
</tr>
<tr class="odd">
<td>Replicate</td>
<td>Repetition of an experimental treatment.</td>
</tr>
<tr class="even">
<td>Balanced Design</td>
<td>Equal number of experimental units for each treatment group.</td>
</tr>
<tr class="odd">
<td>Randomization</td>
<td>Process of randomly assigning explanatory variable(s) of interest to experimental units (e.g., patients, mice, etc.).</td>
</tr>
<tr class="even">
<td>Treatment</td>
<td>A combination of factor levels.</td>
</tr>
<tr class="odd">
<td>A/B Testing</td>
<td>Statistically comparing a key performance indicator (conversion rate, dwell time, etc.) between two (or more) versions of a webpage/app/add to assess which one performs better.</td>
</tr>
<tr class="even">
<td>Observational Study</td>
<td>A study where the researcher does not randomize the primary explanatory variables of interest.</td>
</tr>
</tbody>
</table>
</section>
<section id="two-way-anova-with-main-effects-only" class="level4">
<h4 class="anchored" data-anchor-id="two-way-anova-with-main-effects-only">Two-way ANOVA with main effects only</h4>
<ul>
<li>Typically initial analysis in A/B testing</li>
<li>main effects: standalone regressors (e.g.&nbsp;<code>color</code>, <code>font_size</code>)</li>
</ul>
<p><span class="math display">\[
Y_{i,j,k} = \mu_{i} + \tau_{j} + \varepsilon_{i, j, k}
\]</span></p>
<ul>
<li>For <span class="math inline">\(i\)</span>th <code>font</code> and <span class="math inline">\(j\)</span>th <code>color</code>, for the <span class="math inline">\(k\)</span>th experimental unit</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>OLS_ABs_main_effects <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">formula =</span> Duration <span class="sc">~</span> Font <span class="sc">+</span> Color, <span class="at">data =</span> data)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(OLS_ABs_main_effects)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li>ANOVA tables go hand-in-hand with randomized experiments</li>
</ul>
<p><img src="../images/3_anova.png" width="400"></p>
<ul>
<li>p-values tests the hypothesis that:
<ul>
<li><span class="math inline">\(H_0\)</span>: <span class="math inline">\(\mu_{1} = \mu_{2} = \mu_{3}\)</span> (no effect of <code>font</code>)</li>
<li><span class="math inline">\(H_a\)</span>: at least one <span class="math inline">\(\mu_{i}\)</span> is different</li>
</ul></li>
<li>Recall: If p-value &lt; 0.05, we reject the null hypothesis</li>
<li><code>Df</code> represents the degrees of freedom
<ul>
<li>It is of the formula: <code># of levels - 1</code></li>
</ul></li>
</ul>
</section>
<section id="two-way-anova-with-interaction-effects" class="level4">
<h4 class="anchored" data-anchor-id="two-way-anova-with-interaction-effects">Two-way ANOVA with interaction effects</h4>
<p><span class="math display">\[
Y_{i,j,k} = \mu_{i} + \tau_{j} + (\mu\tau)_{i,j} + \varepsilon_{i, j, k}
\]</span></p>
<ul>
<li>Adds the interaction term <span class="math inline">\((\mu\tau)_{i,j}\)</span> to the model
<ul>
<li>Does not indicate they are multiplied</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>OLS_ABs_interaction <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">formula =</span> Duration <span class="sc">~</span> Font <span class="sc">*</span> Color, <span class="at">data =</span> data)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(OLS_ABs_interaction)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><code>Df</code> for interaction term is the product of <code>Df1</code> and <code>Df2</code></li>
</ul>
</section>
<section id="post-hoc-tests" class="level4">
<h4 class="anchored" data-anchor-id="post-hoc-tests">Post-hoc tests</h4>
<ul>
<li>Done if any factor is significant</li>
<li>Compares all possible pairs among the levels
<ul>
<li>Involves multiple testing corrections</li>
</ul></li>
<li>Will use Tukey’s HSD test
<ul>
<li>Keeps the Family-Wise Error Rate (FWER) at <span class="math inline">\(\alpha\)</span> or less</li>
<li>Only for ANOVA models</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Need aov: basically lm but for ANOVA</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>OLS_aov_ABn <span class="ot">&lt;-</span> <span class="fu">aov</span>(<span class="at">formula =</span> Duration <span class="sc">~</span> Font <span class="sc">*</span> Color, <span class="at">data =</span> data)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">TukeyHSD</span>(OLS_aov_ABn, <span class="at">conf.level =</span> <span class="fl">0.95</span>) <span class="sc">|&gt;</span> <span class="fu">tidy</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
</section>
<section id="blocking" class="level2">
<h2 class="anchored" data-anchor-id="blocking">Blocking</h2>
<ul>
<li><strong>Blocking Factor</strong>: a variable that is not of primary interest (and cannot be controlled) but is known to affect the response variable
<ul>
<li>Consider as grouping factor</li>
<li>Examples: time period when A/B testing is conducted, user demographics, etc.</li>
</ul></li>
<li><strong>“Block what you can, randomize what you cannot.”</strong>
<ul>
<li><strong>Blocking</strong>: removing the effect of secondary measurable variables from the response
<ul>
<li>This is so our model could get statistical association/ causation between the secondary variable and the response variable</li>
</ul></li>
<li><strong>Randomization</strong>: removing the effect of unmeasurable variables</li>
</ul></li>
</ul>
<p><img src="../images/3_blocking_count.png" width="500"></p>
<p><em>Strategy A: Just Randomize, Strategy B: Randomize and Block</em></p>
<section id="blocking-procedure" class="level3">
<h3 class="anchored" data-anchor-id="blocking-procedure">Blocking Procedure</h3>
<ol type="1">
<li>Stratify experimental units into homogenous blocks. Each stratum is a block</li>
<li>Randomize the experimental units into the treatment groups within each block</li>
</ol>
</section>
<section id="randomization-and-blocking-recap" class="level3">
<h3 class="anchored" data-anchor-id="randomization-and-blocking-recap">Randomization and Blocking Recap</h3>
<p>Sorted Best to Worst:</p>
<ol type="1">
<li>Model with blocking for blocking factors + Post-Hoc adjustments</li>
<li>Normal data with Post-Hoc adjustments for blocking factors (Treat blocking as a covariate)
<ul>
<li><strong>covariate</strong>: a variable that is possibly predictive of the response variable</li>
</ul></li>
<li>Raw model with no blocking nor Post-Hoc adjustments</li>
</ol>
</section>
</section>
<section id="increasing-sample-size" class="level2">
<h2 class="anchored" data-anchor-id="increasing-sample-size">Increasing Sample Size</h2>
<ul>
<li>Increasing sample size would:
<ul>
<li>Increase the <strong>accuracy</strong> of the estimates</li>
<li>Increase the <strong>power</strong> of the test
<ul>
<li><strong>Power</strong>: probability of rejecting the null hypothesis when it is false (predict correctly)
<ul>
<li>High power means our A/B test is robust enough to detect and estimate experimental treatment effects</li>
</ul></li>
<li>In class had example: Need 10x the sample size for raw to perform equal to covariate/ blocking</li>
</ul></li>
</ul></li>
<li>But this model would not capture the right systematic component of the population, including the <strong>stratum effect</strong> (demographic categories)</li>
<li>Using covariate and blocking would still be more precise</li>
<li>Need to consider that increasing sample size is also expensive</li>
</ul>
<section id="power-in-sample-size-computations" class="level3">
<h3 class="anchored" data-anchor-id="power-in-sample-size-computations">Power in Sample Size Computations</h3>
<ul>
<li>Recall that sample size computations involve playing around with three concepts:
<ol type="1">
<li><strong>effect size</strong>: how much we want the experimental treatment to differ from the control treatment in terms of the mean response</li>
<li><strong>significance level</strong> <span class="math inline">\(\alpha\)</span>
<ul>
<li>Lower = more strict (less prone to Type I error/ false positive)</li>
<li><span class="math inline">\(P(\text{reject } H_0 | H_0 \text{ is true}) = \alpha\)</span></li>
</ul></li>
<li><strong>power</strong> of the test <span class="math inline">\(1 - \beta = 1 - P(\text{Type II error})\)</span>,
<ul>
<li>Typically 0.8</li>
<li>larger = less prone to Type II error</li>
<li><span class="math inline">\(P(\text{reject } H_0 | H_a \text{ is true}) = 1 - \beta = 1 - P(\text{accept } H_0 | H_a \text{ is true})\)</span></li>
</ul></li>
</ol></li>
</ul>
<p><img src="../images/0_stat_chart.png" width="500"></p>
<table class="table">
<colgroup>
<col style="width: 28%">
<col style="width: 36%">
<col style="width: 36%">
</colgroup>
<thead>
<tr class="header">
<th>Decision</th>
<th>True Condition Positive (<span class="math inline">\(H_a\)</span> True)</th>
<th>True Condition Negative (<span class="math inline">\(H_0\)</span> True)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Test Positive (Reject <span class="math inline">\(H_0\)</span>)</td>
<td>Correct (True Positive)</td>
<td>Type I Error (False Positive)</td>
</tr>
<tr class="even">
<td>Test Negative (Accept <span class="math inline">\(H_0\)</span>)</td>
<td>Type II Error (False Negative)</td>
<td>Correct (True Negative)</td>
</tr>
</tbody>
</table>
<p><em>see more in <a href="https://mds.farrandi.com/block_2/552_stat_inter/552_stat_inter.html#visual-representation-of-errors">my statistical inference notes</a></em></p>
<section id="example-case" class="level4">
<h4 class="anchored" data-anchor-id="example-case">Example case</h4>
<ul>
<li>Lets say we want to see if changeing website design from “X” to “Y” will increase the average time spent on the website.</li>
<li>We know:
<ul>
<li>Current average is between 30s to 2 min</li>
<li>We want to see a 3% increase in time spent</li>
</ul></li>
<li>Calculation:
<ul>
<li><span class="math inline">\(\mu_x = 0.5 + \frac{2-0.5}{2} = 1.25 \text{ min}\)</span></li>
<li>Using 95% CI, <span class="math inline">\(Z_i = \frac{Y_i - \mu_A}{\sigma} \sim \mathcal{N}(0, 1)\)</span>
<ul>
<li><span class="math inline">\(1.96 = \frac{2 - \mu_A}{\sigma}\)</span></li>
<li><span class="math inline">\(\sigma = \frac{2 - 1.25}{1.96} = 0.383\)</span></li>
</ul></li>
<li><span class="math inline">\(\delta = 0.03 \times 1.25 = 0.0375\)</span> (desired difference) <br></li>
</ul></li>
<li>Use <code>pwr.t.test</code> function in R to calculate sample size needed
<ul>
<li>will give <code>n</code> (sample size) needed for <strong>each</strong> group</li>
</ul></li>
</ul>
<div class="sourceCode" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pwr.t.test</span>(</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">d =</span> <span class="fl">0.0375</span> <span class="sc">/</span> <span class="fl">0.383</span>, <span class="co"># delta / sigma</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">sig.level =</span> <span class="fl">0.05</span>,</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">power =</span> <span class="fl">0.8</span>,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"two.sample"</span>,</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">alternative =</span> <span class="st">"greater"</span> <span class="co"># we want to see an increase</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="../images/3_t_plot.png" width="600"></p>
<p><em>Lower power means need less sample size</em></p>
<p><img src="../images/3_ab_size_plot.png" width="600"></p>
<p><em>Higher response increase means more power for a given sample size</em></p>
</section>
</section>
<section id="block-homogeneity-and-power" class="level3">
<h3 class="anchored" data-anchor-id="block-homogeneity-and-power">Block Homogeneity and Power</h3>
<ul>
<li>We want to ensure that the blocks are <strong>homogeneous</strong>:
<ul>
<li>As <strong>much</strong> variation in <span class="math inline">\(\mu\)</span> as possible is <strong>across</strong> the blocks</li>
<li>As <strong>little</strong> variation in <span class="math inline">\(\mu\)</span> as possible is <strong>within</strong> the blocks</li>
</ul></li>
<li>If not homogenous: blocking can be worse than raw</li>
<li>The blocking setup needs to be carefully planned before running the experiment.</li>
</ul>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>